package com.synopsys.integration.blackduck.artifactory.modules.inspection.notifications.model;

import static com.synopsys.integration.blackduck.api.generated.enumeration.ProjectVersionVulnerableBomComponentsItemsVulnerabilityWithRemediationSeverityType.CRITICAL;
import static com.synopsys.integration.blackduck.api.generated.enumeration.ProjectVersionVulnerableBomComponentsItemsVulnerabilityWithRemediationSeverityType.HIGH;
import static com.synopsys.integration.blackduck.api.generated.enumeration.ProjectVersionVulnerableBomComponentsItemsVulnerabilityWithRemediationSeverityType.LOW;
import static com.synopsys.integration.blackduck.api.generated.enumeration.ProjectVersionVulnerableBomComponentsItemsVulnerabilityWithRemediationSeverityType.MEDIUM;

import java.util.Arrays;
import java.util.List;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

import com.synopsys.integration.blackduck.api.generated.enumeration.ProjectVersionVulnerableBomComponentsItemsVulnerabilityWithRemediationSeverityType;
import com.synopsys.integration.blackduck.api.generated.view.VulnerabilityView;

class VulnerabilityAggregateTest {
    @Test
    void fromVulnerabilityViews() {
        List<VulnerabilityView> vulnerabilityViews = Arrays.asList(
            createVulnerabilityView(LOW),
            createVulnerabilityView(MEDIUM),
            createVulnerabilityView(MEDIUM),
            createVulnerabilityView(HIGH),
            createVulnerabilityView(HIGH),
            createVulnerabilityView(HIGH),
            createVulnerabilityView(CRITICAL),
            createVulnerabilityView(CRITICAL),
            createVulnerabilityView(CRITICAL),
            createVulnerabilityView(CRITICAL)
        );

        VulnerabilityAggregate vulnerabilityAggregate = VulnerabilityAggregate.fromVulnerabilityViews(vulnerabilityViews);

        Assertions.assertEquals(1, vulnerabilityAggregate.getLowSeverityCount());
        Assertions.assertEquals(2, vulnerabilityAggregate.getMediumSeverityCount());
        Assertions.assertEquals(3, vulnerabilityAggregate.getHighSeverityCount());
        Assertions.assertEquals(4, vulnerabilityAggregate.getCriticalSeverityCount());
    }

    @Test
    void allValuesUsed() {
        for (ProjectVersionVulnerableBomComponentsItemsVulnerabilityWithRemediationSeverityType severityType : ProjectVersionVulnerableBomComponentsItemsVulnerabilityWithRemediationSeverityType.values()) {
            switch (severityType) {
                case LOW:
                case MEDIUM:
                case HIGH:
                case CRITICAL:
                    break;
                default:
                    Assertions.fail("A severity type supported by Black Duck (" + severityType.name() + ") is currently not supported by the plugin.");
            }
        }
    }

    private VulnerabilityView createVulnerabilityView(ProjectVersionVulnerableBomComponentsItemsVulnerabilityWithRemediationSeverityType severityType) {
        VulnerabilityView vulnerabilityView = new VulnerabilityView();
        vulnerabilityView.setSeverity(severityType);
        return vulnerabilityView;
    }
}
